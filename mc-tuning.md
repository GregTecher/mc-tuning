# Minecraft 调优指南

鉴于发现很多人对Modded Minecraft如何优化一无所知，用着比我好太多的显卡，FPS都不能保持60，吾甚为心痛，遂作此篇，造福mcer

该教程适应于Minecraft各个版本，部分不通用的部分会单独注释

没接触过图形学和游戏编程，有些mod没有去翻源码，纯粹从逻辑上猜测，若有不当之处，欢迎大佬指正补充。

为增加信服力：）说明：个人gtx950m，中等偏下显卡，cpu i5 4210m，玩过各种整合包，包括自己魔改的和curseforge上的，从1.7到1.12，从几十mod到几百mod的整合包，全部维持在稳定60fps，连一点波动都忍受不了。别人玩我的世界培养出了20fps玩游戏的能力，我刚好反着。

## FPS篇

FPS优化的第一准则是：对于掉FPS的东西，要么就眼不见为净（搬到视距外），要么就拆。

所以你以为分布式布局仅仅是为了好玩么。

### 基础知识

- FPS不是越高越好，一般屏幕的刷新率是60或75，FPS高于这个数字并没有太大作用。打开垂直同步会使得FPS锁定在这个频率。不开垂直同步会导致FPS波动，大幅度波动很影响游戏体验。
- 只有视距内的东西会被渲染，视距越大越卡，请调低一点。反言之，将掉FPS的方块放出视野外，眼不见为净就好了。
- 空岛最好，stoneblock类似的没有矿洞的地下世界次之。这两者可渲染区块数（参见下文）会大大减少
- 不要用高清材质包
- 动物特别吃FPS，少养动物。参考第一准则
- 区块更新特别吃FPS。mc的渲染是以16x16x16的一块区域为单位的，什么时候会引起区块更新？方块更新。常见场景如树场，农场，用AA实现的矿工透镜自动化刷矿。其实不同区块更新的代价也不一样，像有些摆满各种可渲染实体的区块更新就比纯圆石的区块更新代价要高。参考第一准则
- 颗粒数调低
- Mipmap1.12.2版本其实对FPS影响不大，这个是经过优化后的。打开可以提高视频质量，何乐而不为。
- 多Mod环境下，关闭地形动画会大幅提高FPS（划重点）
- 空岛建筑请尽可能符合区块边界，有时候多放一个方块就会导致渲染区块数增1

### 进阶调优

目前大部分的FPS是由动态渲染实体导致的，若想要获得高FPS，你需要减少动态渲染实体数量。就个人而言，GregBlock通关的时候，视野内动态渲染实体都最多只有两位数，准确的说不到50，结果是GB从入门到通关FPS一直满60

- 如何查看数量

  打开配置=》视频配置=》其他=》显示FPS=》开，游戏界面左上角会有一排数字

  以1.12.2为例

  ```java
  60/59 fps, C: 25, E: 0+25, U: 15
  ```

  该信息显示的是当前视角前方渲染信息。后方是不参与渲染的，当然区块渲染还是少不了的

  其中C代表可渲染区块数，我视距8，基地是空岛，完全在区块边界内的5x5区块，最低高度起始于65，和最高高度之间相差不到15，加之从基地上方俯视的，所以可渲染区块数量刚好是25。一般人视距8能保持100就不错了。这个C越低越好，道理不言自明。

  E后面的才是正主，“+”前面代表动物实体，比如羊，地精，TC6那个裂缝之类，我啥也没养，所以保持0，最好不过。“+”后面的属于动态渲染实体，两位数，最佳实践。个人见过很多+后数字破千的，即使显卡比我好，FPS那叫一个惨。

- 常见动态渲染实体

  抽屉，透明管道，各种机器，以EnderIO为最，卡的一批。

- 如何测试一个方块是不是可渲染实体

  保持视角不动，右键放置该方块，若渲染实体数量自增1，则证明该方块是可渲染实体

- 待补充

# TPS篇

### 基础知识

minecraft采用tick机制，大部分实体在每tick都会执行update方法，也就是说会占用一定时间。

1s 20tick，TPS20为最佳，这代表只要能够在50ms内执行完一个tick，就可以保持TPS20，具体可以采用`/forge tps`h或`/cofh tps`查看，比如我的

```
Dim0(Overworld): Mean Tick Time: 4.918ms, Mean TPS: 20.000
```

这代表主世界每tick时间大约5ms，离50ms差得远呢。当然这并不代表你把基地还可以再扩大10倍，这并不是个线性函数。

### 基础调优

- 少用红石扯线，红石更新会导致区块更新
- 不要动不动就拿内存说事，诸如我XXG内存为啥FPS这么低？讲真，只要内存足够mc启动起来，内存无论是对FPS和TPS都影响不大。
- mc吃CPU，CPU多核也没太大卵用，mc吃单核，请不要拿我X核X线程CPU为啥FPS这么低来说事，单核频率上不去你能怪谁。
- 机器长期不用可以考虑拆掉或关机，比如软锤，比如热力的高信号工作，比如IF的停止工作。关机后一般不占用TPS
- 可以考虑/gamerule doMobSpawning false，关闭生物生成。和平模式没用，仍然会生成实体，不过是生成实体的瞬间杀死罢了。
- 待补充

### 进阶调优

删除了原先的Mod评论部分，只保留了必要的Mod说明。因为有些Mod评论没有意义，Mod总归会更新的，我只能说下基本不会变动的东西。

#### AE

AE能用硬盘就用硬盘，少用存储总线，虽然存储总线接抽屉很方便，然而这玩意掉TPS。

从逻辑上分析，每次AE系统要输出东西的时候，都会遍历一遍库存，若每tick输出一次，每tick至少要遍历一次库存，当抽屉系统特别大，可能会严重影响TPS。相对而言，AE的硬盘访问无需跨系统，访问速度大大提升。

少用ME驱动器，觉得摆个占满几百个频道的超大规模的驱动器阵列很有成就感是吧，架设100个驱动器，每个驱动器放慢磁盘，每个磁盘满63个类型，那么一共63 x 10 x 100，遍历一次需要遍历63w“类型”，不掉TPS就怪了。

最佳实践是用多少，摆多少，就个人而言，一般情况下4个驱动器足以应付一切。驱动器中有磁盘空着不用是性能浪费。

并行处理单元在提升效率的同时，可能也会降低TPS，斟酌使用。

未标记ME接口其实可以大量使用的，基本不影响TPS，从逻辑上分析，这玩意没必要掉TPS

### RS

和AE形似而神不似，删掉就对了，卡的一批。

任何抢救都无效。无论哪个方面（比如合成，存储）都比AE差一大截子，严重影响TPS

#### GTCE 格雷科技社区版
对于GregBlock1.4.6版本，尝试使用[该分支](https://github.com/GregTecher/GregTech)。在不破坏游戏体验的前提下，优化了一些内容，包括配方、电流、速率
对于工作频率特别高的机器，比如锻造锤，HV甚至可以达到每4Tick工作一次，尽可能避免大规模使用如此高频率的机器。可以考虑自行魔改配方，比如改为8个石头出8个圆石，消耗时间增长为8倍。
GTCE是我至今见过的对于TPS最友好的模组，完全满足了我堆各种机器阵列的梦想
同时GTCE的FPS优化也做的很棒，机器并不是可渲染实体。后期我所有机器都摆在视距内完全不卡。

#### 其他

待补充



## 优化工具篇

### LagGoggle

首推，适应于1.12.2和1.10.2

可视化调优工具，新手友好，哪里变红拆哪里

### Spark
调优工具，适合有一定编程基础的人使用。不如LagGoggle清晰易懂，但是对于会编程的人来说，可以很容易的抓住卡顿源。

### TickProfile

适应于1.7.10，没怎么用过，新手不友好

### openj9
Java虚拟机。具有比hotspot更强的内存管理能力，但理论上说对于CPU的有效利用率不如hotspot。
但有人测试发现FPS会得到提升。
就个人而言，服务器TPS下降，FPS没有明显效果。
不妨一试

## 终极调优

1080，pls

9700k，pls

很科学，能用钱解决的事，为啥要用脑子：）

## 啰嗦几句
社会在进步，Mod也在进步，不要因为某个版本的mod测试时发现了点问题，就以为之后所有版本都避免不了这个问题了。请以实物为准
效果越炫酷越华丽的Mod越卡。拒绝杠精
再华丽的效果如果你看不见就不卡。
并不是按我说的做就一定会有明显效果，任何人也不能打这个包票。但是起码不会让你的FPS/TPS更差

## 其他事项

后期若有更新会在github更新，https://github.com/GregTecher/mc-tuning

[GTCE优化版](https://github.com/GregTecher/GregTech)



